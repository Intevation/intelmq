#!/usr/bin/make -f

# This file is based on a version
# automatically generated by stdeb 0.8.5 at
# Wed, 23 Mar 2016 17:49:26 +0000
export PYBUILD_NAME=intelmq
%:
	dh $@ --with python3 --without python2 --buildsystem=pybuild

override_dh_auto_build:

override_dh_auto_install:
	python3 setup.py install --root=debian/intelmq --prefix=/usr
	mv debian/intelmq/opt/intelmq/etc/examples/* debian/intelmq/opt/intelmq/etc/
	sed -i '/logging_level/s/DEBUG/INFO/' debian/intelmq/opt/intelmq/etc/system.conf
	rmdir debian/intelmq/opt/intelmq/etc/examples
	mkdir -p debian/intelmq/opt/intelmq/var/log
	mkdir -p debian/intelmq/opt/intelmq/var/lib/bots/file-output
	mkdir -p debian/intelmq/etc/logrotate.d
	sed 's@/usr/local/bin@/usr/bin@' contrib/logrotate/intelmq >debian/intelmq/etc/logrotate.d/intelmq
	# install a modifier bot conf file besides the example file
	cp -a debian/intelmq/opt/intelmq/var/lib/bots/modify/example/modify.conf \
		debian/intelmq/opt/intelmq/var/lib/bots/modify/modify.conf
	# Fix a path in postgresql output bot README
	mkdir -p debian/intelmq/usr/share/doc/intelmq/bots/outputs/postgresql/
	sed 's@intelmq/bin/intelmq_psql_initdb.py@intelmq_psql_initdb@' \
		intelmq/bots/outputs/postgresql/README.md > \
		debian/intelmq/usr/share/doc/intelmq/bots/outputs/postgresql/README.md
